---
layout: post
title: Java 动态代理
category : [JavaEE]
tagline: "Supporting tagline"
tags : [动态代理]
---
{% include JB/setup %}
# Java 动态代理
---

## 代理模式

> 参考：《JAVA 程序性能优化》

将代理类用于实现延迟加载，可以有效地提升系统的启动速度。

延迟加载的核心思想是：如果当前并没有使用这个组件，则不需要真正地初始化它，使用一个代理对象替代它的原有位置，只要在真正需要使用的时候，才对它进行加载。

<!--break-->

代理模式的实现如下：

假设有一个接口 IDBQuery，它只有一个 request() 方法：

```
public interface IDBQuery {
  String request();
}
```

DBQuery 的实现如下，它是一个重量级对象，构造会比较慢：

```
public class DBQuery implements IDBQuery {
  public DBQuery() {
    System.out.println("query...");
  }
  
  @Override
  public String request() {
    return "request string";
  }
}
```

代理类 DBQueryProxy 是轻量级对象，创建很快，用于替代 DBQuery 的位置：

```
public class DBQueryProxy implements IDBQuery {
  private DBQuery real = null;
  
  @Override
  public String request() {
    if (real == null) {
      real = new DBQuery();
    }
    return real.request();
  }
}
```

最后，主函数如下，它引用 IDBQuery 接口，并使用代理类工作：

```
public class Main {
  public static void main(String args[]) {
    IDBQuery q = new DBQueryProxy();
    q.request();
  }
}
```


## JDK 动态代理

> 参考：
>
> [Java 动态代理机制分析及扩展](https://www.ibm.com/developerworks/cn/java/j-lo-proxy1/index.html)


## 动态代理的运用
HibernateProxy
EntityManager


