---
layout: post
title: JHipster 的学习和使用
category : [JavaEE]
tagline: "Supporting tagline"
tags : [JHipster]
---
{% include JB/setup %}
# JHipster 的学习和使用
---

[JHipster](https://jhipster.github.io/) 或者称 Java Hipster，是一个应用代码产生器，能够创建 spring Boot + AngularJS + Bootstrap 的应用。



> [jhipster-book - 百度文库](https://wenku.baidu.com/link?url=tqm3GMMz0AFPc7RwGvUmEJ91br1StYTrVPvhWKkQ57VjmmUXUGkSxV5CkV-kts-GbHKJScQcVTH2roilaLVQlaXYUqpyWh5PbSLjzJwRv_DautTlmGgsqKhxwVManmGX) 



<!--break-->



##  环境安装及配置 

#### Node.js 

http://blog.csdn.net/u011102951/article/details/36422939

https://nodejs.org/en/download/package-manager/

https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions



http://www.cnblogs.com/kevin19900306/p/5701281.html （配置环境变量同 gradle）

这种方法安装的 nodejs，在更新 nodejs 版本以后要，因为项目中的 nodejs 的目录需要是：

``` 
$ whick node
/usr/local/bin/node 
```



更新 nodejs 版本： 

``` 
npm install -g n 
n stable 
```



#### npm   

> http://blog.csdn.net/zhy421202048/article/details/53490247  

npm 是一个很好用的工具，全场是 Node Packet Manager，是一个 nodejs 的包管理工具，但是美中不足的是当我们去安转包的时候却发现下载的速度太慢，但是没关系，还是有方法的就是利用淘宝的国内镜像，一下是 3 个设置的方法：

镜像使用方法（三种办法任意一种都能解决问题，建议使用第三种，将配置写死，下次用的时候配置还在）:

1. 通过 config 命令

```
npm config set registry https://registry.npm.taobao.org 
npm info underscore （如果上面配置正确这个命令会有字符串response）
```

2. 命令行指定

```
npm --registry https://registry.npm.taobao.org info underscore 
```

3. 编辑 `~/.npmrc` 加入下面内容

```
registry = https://registry.npm.taobao.org
```



### yarn 

``` 
npm install -g yarn 
```

http://www.cnblogs.com/liboxncg/p/6006226.html 



#### Yeoman   

> yeoman 

```
> npm install -g yo 
```



#### Bower  

> Bower 

``` 
> npm install -g bower 

```

####    

#### Gulp  

> Gulp  

```
> npm install -g gulp 
```



> [npm,bower,gulp 使用](http://blog.csdn.net/tiansan/article/details/68922497) 



####  JHipster Generator  

> JHipster Generator 

```
> sudo npm install -g generator-jhipster  
```



## 创建一个应用 



#### 创建一个空项目目录 

``` 
mkdir jhipster-demo
```



#### 进入该目录 

``` 
cd jhipster-demo 
```



#### 生成应用  

安装过程要选择一些配置，见 [Creating an application](https://jhipster.github.io/creating-an-app/) 。 

``` 
> yo jhipster 
```



#### 创建 gulpfile.js 文件，并执行 gulp 命令

``` 
> gulp 
```



#### 创建实体  

JHipster 通过 entity sub-generator 自动创建前后端相应代码： 

``` 
> yo jhipster:entity [optons] <name>
```

对于比较复杂的实体（数量多，关系复杂，字段多），建议使用 JHipster UML 和 JDL Studio。

``` 
> yo jhipster:import-jdl your-jdl-file.jh 
```

运行上面命令前，最好先运行： 

``` 
yo jhipster-entity-audit （只需运行一次）
```



#### 安装 generator-jhipster-entity-audit  

> https://www.npmjs.com/package/generator-jhipster-entity-audit 

> JHipster module to enable entity auditing and to add audit log page

**Note:** This module does not support Angular 2+ yet and hence will not work if you are using JHipster 4 with Angular2.

##### Usage

This is a [JHipster](http://jhipster.github.io/) module, that is meant to be used in a JHipster application.

You can choose to enable audit for all entities or choose the entities to be audited from a list during generation.

The module will extend the selected entities and its DTOs with `AbstractAuditingEntity` and `AbstractAuditingDTO` class respectively to enable audits, hence make sure that your entities/DTOs doesn't have any super class.

This will also add new columns to the liquibase changeset for the entities, so it is ideal to recreate the tables if you are enabling this for existing entities.

The Audit log page is optional and can be added by choosing the option while running the generator

jhipster-entity-audit module will register itself as a hook for Jhipster and the question to enable audit will available during future entity generation as well

##### [BETA] Javers integration

When using sql or mongodb you can use [Javers](http://javers.org/) for entity auditing.

> **BETA Notice** Javers integration is still in beta state. Expect some rough edges!

The module will add [spring-boot integration for javers](http://javers.org/documentation/spring-boot-integration/). Each repository is annotated with the required `@JaversSpringDataAuditable` annotation. The new class `JaversAuthorProvider` provides javers with the correct user modifying an entity.

##### Installation

As this is a [JHipster](http://jhipster.github.io/) module, we expect you have [JHipster and its related tools already installed](http://jhipster.github.io/installation.html).

This module requires Jhipster version greater than 3.0 in order to work.

```
npm install -g generator-jhipster-entity-audit
```

Then run the module on a JHipster generated application:

```
yo jhipster-entity-audit
```

If you want don't want to answer each question you can use.

```
yo jhipster-entity-audit default
```

This will enable auditing for all available entities (only ones created by the jhipster:entity generator) and add the audit log page under admin.  



### JHipster 数据库保留字  





### 将 Postgres 数据库改为 Mysql 数据库 

- 修改配置信息：

  ``` 
  datasource:
          type: com.zaxxer.hikari.HikariDataSource
          url: jdbc:postgresql://localhost:5432/xxx
          username: xxx
          password:
      jpa:
          database-platform: io.github.jhipster.domain.util.FixedPostgreSQL82Dialect
          database: POSTGRESQL
          show-sql: false
          properties:
              hibernate.id.new_generator_mappings: true
              hibernate.cache.use_second_level_cache: true
              hibernate.cache.use_query_cache: false
              hibernate.generate_statistics: false
              hibernate.cache.region.factory_class: com.hazelcast.hibernate.HazelcastCacheRegionFactory
              hibernate.cache.hazelcast.instance_name: academy
              hibernate.cache.use_minimal_puts: true
              hibernate.cache.hazelcast.use_lite_member: true
  ```

  改为：

  ``` 
      datasource:
          type: com.zaxxer.hikari.HikariDataSource
          url: jdbc:mysql://localhost:3306/academy
          username: root
          password: root
      jpa:
          database-platform: org.hibernate.dialect.MySQL5InnoDBDialect
          database: MYSQL
          show-sql: false
          properties:
              hibernate.id.new_generator_mappings: true
              hibernate.cache.use_second_level_cache: true
              hibernate.cache.use_query_cache: false
              hibernate.generate_statistics: false
              hibernate.cache.region.factory_class: com.hazelcast.hibernate.HazelcastCacheRegionFactory
              hibernate.cache.hazelcast.instance_name: academy
              hibernate.cache.use_minimal_puts: true
              hibernate.cache.hazelcast.use_lite_member: true
  ```

  ​



- 修改实体结构的xml文件 

  ``` 
  <property name="now" value="now()" dbms="mysql"/>
  <property name="autoIncrement" value="true"/> 
  ```
  ​

- 修改实体类的id的注解属性

  ``` 
  @Id
  @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "sequenceGenerator")
  @SequenceGenerator(name = "sequenceGenerator")
  private Long id;
  ```

  改为： 

  ``` 
  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id; 
  ```
  ​

- 修改 含有 boolean 类型的表的 loadData 标签 

  ``` 
  <loadData encoding="UTF-8"
                    file="config/liquibase/users.csv"
                    separator=";"
                    tableName="jhi_user"/>
  ```

  改为：

  ``` 
  <loadData encoding="UTF-8"
                    file="config/liquibase/users.csv"
                    separator=";"
                    tableName="jhi_user">
              <column header="activated" name="activated" type="BOOLEAN"/>
          </loadData>
  ```

  ​

- 测试

  本地新建数据库，将 spring.profiles.active 值改为 prod。





## FAQ 

1. ibase.exception.ChangeLogParseException: Error Reading Migration File: class path resource [config/liquibase/master.xml] cannot be resolved to URL because it does not exist  




2. 将项目打包通过 ssh 远程部署项目，启动，报下面的异常： 


```
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'h2TCPServer' defined in class path resource [com/hithinksoft/entinfo/config/DatabaseConfiguration.class]: Invocation of init method failed; nested exception is org.h2.jdbc.JdbcSQLException: IO Exception: "java.net.UnknownHostException: iZ8vb2ld3i9qrgl4hwxxwqZ: iZ8vb2ld3i9qrgl4hwxxwqZ: Name or service not known" [90028-193]

```

把 iZ8vb2ld3i9qrgl4hwxxwqZ 添加到 hosts 文件中。 



3. 根据 .jh 文件生成实体后，启动，报下面的异常： 

```
... 

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.class]: Invocation of init method failed; nested exception is javax.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory
	at 
	... 
	... 
	... 
	
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory
	at 
	...  
	... 
	... 
	
Caused by: java.lang.IllegalStateException: All Hibernate caches should be created upfront. Please update CacheConfiguration.java with the missing cache
	at 
	... 
	... 
	... 


Process finished with exit code 0
```

禁用 EntityAuditEvent 的缓存：

```
@Entity
@Table(name = "jhi_entity_audit_event")
@Cache(usage = CacheConcurrencyStrategy.NONE)
public class EntityAuditEvent implements Serializable{
```

> 使用 yo  jhipster-entity-audit 命令时也不需要更新其他文件。



4. 如果  CacheConfiguration.java 或者 master.xml 等文件不能自动注入，则是因为代码中的注释被删除。

CacheConfiguration.java 

``` 
@Bean
    public JCacheManagerCustomizer cacheManagerCustomizer() {
        return cm -> {
        
        
		// jhipster-needle-ehcache-add-entry
	}
}
```



master.xml 

``` 
<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <include file="classpath:config/liquibase/changelog/00000000000000_initial_schema.xml" relativeToChangelogFile="false"/> 
    
    
	<!-- jhipster-needle-liquibase-add-changelog - JHipster will add liquibase changelogs here --> 


	<!-- jhipster-needle-liquibase-add-constraints-changelog - JHipster will add liquibase constraints changelogs here -->  
	
</databaseChangeLog>
```

